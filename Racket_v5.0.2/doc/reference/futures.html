<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text-html; charset=utf-8" /><title>10.4&nbsp;Futures for Parallelism</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default" /><link rel="stylesheet" type="text/css" href="extras.css" title="default" /><link rel="stylesheet" type="text/css" href="../racket.css" title="default" /><link rel="stylesheet" type="text/css" href="../scribble-style.css" title="default" /><script type="text/javascript" src="../scribble-common.js"></script></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist" style="margin-bottom: 1em;"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" pltdoc="x"><span style="font-weight: bold">Reference</span>:<span class="mywbr"> </span> Racket</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="model.html" class="tocviewlink" pltdoc="x">Language Model</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="syntax.html" class="tocviewlink" pltdoc="x">Syntactic Forms</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="data.html" class="tocviewlink" pltdoc="x">Datatypes</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="structures.html" class="tocviewlink" pltdoc="x">Structures</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="mzlib_class.html" class="tocviewlink" pltdoc="x">Classes and Objects</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="mzlib_unit.html" class="tocviewlink" pltdoc="x">Units</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="contracts.html" class="tocviewlink" pltdoc="x">Contracts</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="match.html" class="tocviewlink" pltdoc="x">Pattern Matching</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="control.html" class="tocviewlink" pltdoc="x">Control Flow</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="concurrency.html" class="tocviewselflink" pltdoc="x">Concurrency</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="Macros.html" class="tocviewlink" pltdoc="x">Macros</a></td></tr><tr><td align="right">12&nbsp;</td><td><a href="input-and-output.html" class="tocviewlink" pltdoc="x">Input and Output</a></td></tr><tr><td align="right">13&nbsp;</td><td><a href="security.html" class="tocviewlink" pltdoc="x">Reflection and Security</a></td></tr><tr><td align="right">14&nbsp;</td><td><a href="os.html" class="tocviewlink" pltdoc="x">Operating System</a></td></tr><tr><td align="right">15&nbsp;</td><td><a href="memory.html" class="tocviewlink" pltdoc="x">Memory Management</a></td></tr><tr><td align="right">16&nbsp;</td><td><a href="unsafe.html" class="tocviewlink" pltdoc="x">Unsafe Operations</a></td></tr><tr><td align="right">17&nbsp;</td><td><a href="running.html" class="tocviewlink" pltdoc="x">Running Racket</a></td></tr><tr><td align="right"></td><td><a href="doc-bibliography.html" class="tocviewlink" pltdoc="x">Bibliography</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>10&nbsp;</td><td><a href="concurrency.html" class="tocviewlink" pltdoc="x">Concurrency</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">10.1&nbsp;</td><td><a href="threads.html" class="tocviewlink" pltdoc="x">Threads</a></td></tr><tr><td align="right">10.2&nbsp;</td><td><a href="all-sync.html" class="tocviewlink" pltdoc="x">Synchronization</a></td></tr><tr><td align="right">10.3&nbsp;</td><td><a href="thread-local-storage.html" class="tocviewlink" pltdoc="x">Thread-<wbr></wbr>Local Storage</a></td></tr><tr><td align="right">10.4&nbsp;</td><td><a href="" class="tocviewselflink" pltdoc="x">Futures for Parallelism</a></td></tr><tr><td align="right">10.5&nbsp;</td><td><a href="places.html" class="tocviewlink" pltdoc="x"><span style="font-weight: bold">Places</span>:<span class="mywbr"> </span> Coarse-<wbr></wbr>grained Parallelism</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><a href="#(def._((lib._racket/future..rkt)._future))" class="tocsublink" pltdoc="x"><span title="Provided from: racket/future, racket"><span class="RktSym"><span class="RktValLink">future</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._racket/future..rkt)._touch))" class="tocsublink" pltdoc="x"><span title="Provided from: racket/future, racket"><span class="RktSym"><span class="RktValLink">touch</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._racket/future..rkt)._current-future))" class="tocsublink" pltdoc="x"><span title="Provided from: racket/future, racket"><span class="RktSym"><span class="RktValLink">current-<wbr></wbr>future</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._racket/future..rkt)._future~3f))" class="tocsublink" pltdoc="x"><span title="Provided from: racket/future, racket"><span class="RktSym"><span class="RktValLink">future?</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._racket/future..rkt)._processor-count))" class="tocsublink" pltdoc="x"><span title="Provided from: racket/future, racket"><span class="RktSym"><span class="RktValLink">processor-<wbr></wbr>count</span></span></span></a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.0.2&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.0.2&quot;);">top</a></span><span class="navright"><a href="parameters.html" title="backward to &quot;10.3.2 Parameters&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="concurrency.html" title="up to &quot;10 Concurrency&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="places.html" title="forward to &quot;10.5 Places: Coarse-grained Parallelism&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4>10.4<tt>&nbsp;</tt><a name="(part._futures)"></a><a name="(mod-path._racket/future)"></a>Futures for Parallelism</h4><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p><span class="imageleft"><img src="finger.png" alt="+" /></span><a href="../guide/performance.html#(part._effective-futures)" pltdoc="x">Parallelism with Futures</a> in <a href="../guide/index.html" pltdoc="x"><span style="font-weight: bold">Guide</span>: Racket</a> introduces futures.</p></blockquote></blockquote></blockquote><p><div class="SIntrapara"><table cellspacing="0" class="defmodule"><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="require.html#(form._((lib._racket/private/base..rkt)._require))" class="RktStxLink" pltdoc="x">require</a></span><span class="stt"> </span><a href="" class="RktModLink" pltdoc="x"><span class="RktSym">racket/future</span></a><span class="RktPn">)</span></td></tr></table></div><div class="SIntrapara">The bindings documented in this section are provided by the <a href="" class="RktModLink" pltdoc="x"><span class="RktSym">racket/future</span></a> and <a href="index.html" class="RktModLink" pltdoc="x"><span class="RktSym">racket</span></a> libraries, but not <a href="index.html" class="RktModLink" pltdoc="x"><span class="RktSym">racket/base</span></a>.</div></p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>Currently, parallel support for <span class="RktSym"><a href="#(def._((lib._racket/future..rkt)._future))" class="RktValLink" pltdoc="x">future</a></span> is
enabled by default for Windows, Linux x86/x86_64, and Mac OS X
x86/x86_64. To enable support for other platforms, use
<span class="nobreak"><span class="stt">--enable-futures</span></span> with <span class="stt">configure</span> when building
Racket.</p></blockquote></blockquote></blockquote><p>The <span class="RktSym"><a href="#(def._((lib._racket/future..rkt)._future))" class="RktValLink" pltdoc="x">future</a></span> and <span class="RktSym"><a href="#(def._((lib._racket/future..rkt)._touch))" class="RktValLink" pltdoc="x">touch</a></span> functions from
<a href="" class="RktModLink" pltdoc="x"><span class="RktSym">racket/future</span></a> provide access to parallelism as
supported by the hardware and operation system.
In contrast to <span class="RktSym"><a href="threads.html#(def._((quote._~23~25kernel)._thread))" class="RktValLink" pltdoc="x">thread</a></span>, which provides concurrency for
arbitrary computations without parallelism, <span class="RktSym"><a href="#(def._((lib._racket/future..rkt)._future))" class="RktValLink" pltdoc="x">future</a></span> provides
parallelism for limited computations. A future executes its work in
parallel (assuming that support for parallelism is available) until it
detects an attempt to perform an operation that is too complex for the
system to run safely in parallel. Similarly, work in a future is
suspended if it depends in some way on the current continuation, such
as raising an exception. A suspended computation for a future is
resumed when <span class="RktSym"><a href="#(def._((lib._racket/future..rkt)._touch))" class="RktValLink" pltdoc="x">touch</a></span> is applied to the future.</p><p>&ldquo;Safe&rdquo; parallel execution of a future means that all operations
provided by the system must be able to enforce contracts and produce
results as documented. &ldquo;Safe&rdquo; does not preclude concurrent access to
mutable data that is visible in the program.  For example, a
computation in a future might use <span class="RktSym"><a href="set_.html#(form._((quote._~23~25kernel)._set!))" class="RktStxLink" pltdoc="x">set!</a></span> to modify a shared
variable, in which case concurrent assignment to the variable can be
visible in other futures and threads. Furthermore, guarantees about
the visibility of effects and ordering are determined by the operating
system and hardware &ndash; which rarely support, for example, the guarantee
of sequential consistency that is provided for <span class="RktSym"><a href="threads.html#(def._((quote._~23~25kernel)._thread))" class="RktValLink" pltdoc="x">thread</a></span>-based
concurrency. At the same time, operations that seem obviously safe may
have a complex enough implementation internally that they cannot run
in parallel. See also <a href="../guide/performance.html#(part._effective-futures)" pltdoc="x">Parallelism with Futures</a>.</p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><table cellspacing="0" class="together"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._racket/future..rkt)._future))"></a><a name="(def._((lib._racket/future..rkt)._future))"></a><span title="Provided from: racket/future, racket"><span class="RktSym"><a href="#(def._((lib._racket/future..rkt)._future))" class="RktValLink" pltdoc="x">future</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">thunk</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._racket/future..rkt)._future~3f))" class="RktValLink" pltdoc="x">future?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">thunk</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Function_Contracts.html#(form._((lib._racket/contract..rkt)._-~3e))" class="RktStxLink" pltdoc="x">-&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="Data-structure_Contracts.html#(form._((lib._racket/contract/private/guts..rkt)._any))" class="RktStxLink" pltdoc="x">any</a></span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" class="together"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._racket/future..rkt)._touch))"></a><a name="(def._((lib._racket/future..rkt)._touch))"></a><span title="Provided from: racket/future, racket"><span class="RktSym"><a href="#(def._((lib._racket/future..rkt)._touch))" class="RktValLink" pltdoc="x">touch</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="Data-structure_Contracts.html#(form._((lib._racket/contract/private/guts..rkt)._any))" class="RktStxLink" pltdoc="x">any</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">f</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._racket/future..rkt)._future~3f))" class="RktValLink" pltdoc="x">future?</a></span></td></tr></table></td></tr></table></div><div class="SIntrapara">The <span class="RktSym"><a href="#(def._((lib._racket/future..rkt)._future))" class="RktValLink" pltdoc="x">future</a></span> procedure returns a future value that
 encapsulates <span class="RktVar">thunk</span>. The <span class="RktSym"><a href="#(def._((lib._racket/future..rkt)._touch))" class="RktValLink" pltdoc="x">touch</a></span> function forces the
 evaluation of the <span class="RktVar">thunk</span> inside the given future, returning
 the values produced by <span class="RktVar">thunk</span>. After <span class="RktSym"><a href="#(def._((lib._racket/future..rkt)._touch))" class="RktValLink" pltdoc="x">touch</a></span> forces
 the evaluation of a <span class="RktVar">thunk</span>, the resulting values are retained
 by the future in place of <span class="RktVar">thunk</span>, and additional
 <span class="RktSym"><a href="#(def._((lib._racket/future..rkt)._touch))" class="RktValLink" pltdoc="x">touch</a></span>es of the future return those values.</div></p><p>Between a call to <span class="RktSym"><a href="#(def._((lib._racket/future..rkt)._future))" class="RktValLink" pltdoc="x">future</a></span> and <span class="RktSym"><a href="#(def._((lib._racket/future..rkt)._touch))" class="RktValLink" pltdoc="x">touch</a></span> for a given
 future, the given <span class="RktVar">thunk</span> may run speculatively in parallel to
 other computations, as described above.</p><p><table cellspacing="0"><tr><td><table cellspacing="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="let.html#(form._((lib._racket/private/letstx-scheme..rkt)._let))" class="RktStxLink" pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktVar">f</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._racket/future..rkt)._future))" class="RktValLink" pltdoc="x">future</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="lambda.html#(form._((lib._racket/private/base..rkt)._lambda))" class="RktStxLink" pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPlain"><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="pairs.html#(def._((quote._~23~25kernel)._list))" class="RktValLink" pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="generic-numbers.html#(def._((quote._~23~25kernel)._+))" class="RktValLink" pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#(def._((lib._racket/future..rkt)._touch))" class="RktValLink" pltdoc="x">touch</a></span><span class="hspace">&nbsp;</span><span class="RktVar">f</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">'(7<span class="stt"> </span>3)</span></p></td></tr></table></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._racket/future..rkt)._current-future))"></a><a name="(def._((lib._racket/future..rkt)._current-future))"></a><span title="Provided from: racket/future, racket"><span class="RktSym"><a href="#(def._((lib._racket/future..rkt)._current-future))" class="RktValLink" pltdoc="x">current-future</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._racket/future..rkt)._future~3f))" class="RktValLink" pltdoc="x">future?</a></span><span class="RktPn">)</span></td></tr></table></div><div class="SIntrapara">Returns the descriptor of the future whose thunk execution is the
current continuation. If a future thunk itself uses <span class="RktSym"><a href="#(def._((lib._racket/future..rkt)._touch))" class="RktValLink" pltdoc="x">touch</a></span>,
future-thunk executions can be nested, in which case the descriptor of the
most immediately executing future is returned. If the current
continuation is not a future-thunk execution, the result is <span class="RktVal">#f</span>.</div></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._racket/future..rkt)._future~3f))"></a><a name="(def._((lib._racket/future..rkt)._future~3f))"></a><span title="Provided from: racket/future, racket"><span class="RktSym"><a href="#(def._((lib._racket/future..rkt)._future~3f))" class="RktValLink" pltdoc="x">future?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">v</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="booleans.html#(def._((quote._~23~25kernel)._boolean~3f))" class="RktValLink" pltdoc="x">boolean?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">v</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="Data-structure_Contracts.html#(def._((lib._racket/contract/private/guts..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr></table></div><div class="SIntrapara">Returns <span class="RktVal">#t</span> if <span class="RktVar">v</span> is a future value,
<span class="RktVal">#f</span> otherwise.</div></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._racket/future..rkt)._processor-count))"></a><a name="(def._((lib._racket/future..rkt)._processor-count))"></a><span title="Provided from: racket/future, racket"><span class="RktSym"><a href="#(def._((lib._racket/future..rkt)._processor-count))" class="RktValLink" pltdoc="x">processor-count</a></span></span><span class="RktPn"></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="number-types.html#(def._((quote._~23~25kernel)._exact-positive-integer~3f))" class="RktValLink" pltdoc="x">exact-positive-integer?</a></span></td></tr></table></div><div class="SIntrapara">Returns the number of parallel computation units (e.g., processors
or cores) that are available on the current machine.</div></p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.0.2&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.0.2&quot;);">top</a></span><span class="navright"><a href="parameters.html" title="backward to &quot;10.3.2 Parameters&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="concurrency.html" title="up to &quot;10 Concurrency&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="places.html" title="forward to &quot;10.5 Places: Coarse-grained Parallelism&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>