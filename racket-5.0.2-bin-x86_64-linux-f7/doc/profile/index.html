<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text-html; charset=utf-8" /><title>Profile: Statistical Profiler</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default" /><link rel="stylesheet" type="text/css" href="../racket.css" title="default" /><link rel="stylesheet" type="text/css" href="../scribble-style.css" title="default" /><script type="text/javascript" src="../scribble-common.js"></script></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist" style="margin-bottom: 1em;"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" pltdoc="x"><span style="font-weight: bold">Profile</span>:<span class="mywbr"> </span> Statistical Profiler</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#(part._.Toplevel_.Interface)" class="tocviewlink" pltdoc="x">Toplevel Interface</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#(part._sampler)" class="tocviewlink" pltdoc="x">Collecting Profile Information</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#(part._analyzer)" class="tocviewlink" pltdoc="x">Analyzing Profile Data</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="#(part._renderers)" class="tocviewlink" pltdoc="x">Profile Renderers</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#(part._.Toplevel_.Interface)" class="tocsubseclink" pltdoc="x">Toplevel Interface</a></td></tr><tr><td><a href="#(def._((lib._profile/main..rkt)._profile-thunk))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: profile"><span class="RktSym"><span class="RktValLink">profile-<wbr></wbr>thunk</span></span></span></a></td></tr><tr><td><a href="#(form._((lib._profile/main..rkt)._profile))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: profile"><span class="RktSym"><span class="RktStxLink">profile</span></span></span></a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#(part._sampler)" class="tocsubseclink" pltdoc="x">Collecting Profile Information</a></td></tr><tr><td><a href="#(def._((lib._profile/sampler..rkt)._create-sampler))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: profile/sampler"><span class="RktSym"><span class="RktValLink">create-<wbr></wbr>sampler</span></span></span></a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#(part._analyzer)" class="tocsubseclink" pltdoc="x">Analyzing Profile Data</a></td></tr><tr><td><a href="#(def._((lib._profile/analyzer..rkt)._analyze-samples))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: profile/analyzer"><span class="RktSym"><span class="RktValLink">analyze-<wbr></wbr>samples</span></span></span></a></td></tr><tr><td><a href="#(def._((lib._profile/analyzer..rkt)._profile))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: profile/analyzer"><span class="RktSym">profile</span></span></a></td></tr><tr><td><a href="#(def._((lib._profile/analyzer..rkt)._node))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: profile/analyzer"><span class="RktSym">node</span></span></a></td></tr><tr><td><a href="#(def._((lib._profile/analyzer..rkt)._edge))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: profile/analyzer"><span class="RktSym">edge</span></span></a></td></tr><tr><td><span class="tocsublinknumber">4<tt>&nbsp;</tt></span><a href="#(part._renderers)" class="tocsubseclink" pltdoc="x">Profile Renderers</a></td></tr><tr><td><span class="tocsublinknumber">4.1<tt>&nbsp;</tt></span><a href="#(part._.Textual_.Rendering)" class="tocsubseclink" pltdoc="x">Textual Rendering</a></td></tr><tr><td><a href="#(def._((lib._profile/render-text..rkt)._render))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: profile/render-text"><span class="RktSym">render</span></span></a></td></tr><tr><td><span class="tocsublinknumber">4.2<tt>&nbsp;</tt></span><a href="#(part._.Graph_.Rendering)" class="tocsubseclink" pltdoc="x">Graph Rendering</a></td></tr><tr><td><a href="#(def._((lib._profile/render-graphviz..rkt)._render))" class="tocsubnonseclink" pltdoc="x"><span title="Provided from: profile/render-graphviz"><span class="RktSym">render</span></span></a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">Version: 5.0.2</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.0.2&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.0.2&quot;);">top</a></span><span class="navright"><span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.0.2&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div><h2><a name="(part._top)"></a><a name="(part._.Profile__.Statistical_.Profiler)"></a><span style="font-weight: bold">Profile</span>: Statistical Profiler</h2><p>The <span class="RktSym">profile</span> collection implements a statistical profiler.
The profiling is done by running a background thread that collects
stack snapshots via <span class="RktSym"><a href="../reference/contmarks.html#(def._((quote._~23~25kernel)._continuation-mark-set-~3econtext))" class="RktValLink" pltdoc="x">continuation-mark-set-&gt;context</a></span>, meaning
that the result is an estimate of the execution costs and it is
limited to the kind of information that
<span class="RktSym"><a href="../reference/contmarks.html#(def._((quote._~23~25kernel)._continuation-mark-set-~3econtext))" class="RktValLink" pltdoc="x">continuation-mark-set-&gt;context</a></span> produces (most notably being
limited to functions calls, and subject to compiler optimizations);
but the result is often useful.  In practice, since this method does
not require recompilation of your source and has very little runtime
overhead, it can be used for longer runs which compensates for these
limits.</p><table cellspacing="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#(part._.Toplevel_.Interface)" class="toptoclink" pltdoc="x">1<span class="hspace">&nbsp;</span>Toplevel Interface</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#(part._sampler)" class="toptoclink" pltdoc="x">2<span class="hspace">&nbsp;</span>Collecting Profile Information</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#(part._analyzer)" class="toptoclink" pltdoc="x">3<span class="hspace">&nbsp;</span>Analyzing Profile Data</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#(part._renderers)" class="toptoclink" pltdoc="x">4<span class="hspace">&nbsp;</span>Profile Renderers</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#(part._.Textual_.Rendering)" class="toclink" pltdoc="x">4.1<span class="hspace">&nbsp;</span>Textual Rendering</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#(part._.Graph_.Rendering)" class="toclink" pltdoc="x">4.2<span class="hspace">&nbsp;</span>Graph Rendering</a></p></td></tr></table><h3>1<tt>&nbsp;</tt><a name="(part._.Toplevel_.Interface)"></a><a name="(mod-path._profile)"></a>Toplevel Interface</h3><p><table cellspacing="0" class="defmodule"><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="RktStxLink" pltdoc="x">require</a></span><span class="stt"> </span><a href="#(mod-path._profile)" class="RktModLink" pltdoc="x"><span class="RktSym"><span class="RktStxLink">profile</span></span></a><span class="RktPn">)</span></td></tr></table></p><p>This module provides one procedure and one macro that are convenient
high-level entry points for timing expressions.  This hides the
details that are available through other parts of the library, and is
intended as a convenient tool for profiling code.</p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><table cellspacing="0" class="prototype"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._profile/main..rkt)._profile-thunk))"></a><a name="(def._((lib._profile/main..rkt)._profile-thunk))"></a><span title="Provided from: profile"><span class="RktSym"><a href="#(def._((lib._profile/main..rkt)._profile-thunk))" class="RktValLink" pltdoc="x">profile-thunk</a></span></span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">thunk</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span>[</td><td><span class="RktPn">#:delay</span><span class="hspace">&nbsp;</span><span class="RktVar">delay</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:repeat</span><span class="hspace">&nbsp;</span><span class="RktVar">iterations</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:threads</span><span class="hspace">&nbsp;</span><span class="RktVar">threads?</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:render</span><span class="hspace">&nbsp;</span><span class="RktVar">renderer</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:periodic-renderer</span><span class="hspace">&nbsp;</span><span class="RktVar">periodic-renderer</span>]<span class="RktPn">)</span></td><td><span class="hspace">&nbsp;</span></td><td>&rarr;</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="../reference/void.html#(def._((quote._~23~25kernel)._void~3f))" class="RktValLink" pltdoc="x">void?</a></span></td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">thunk</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Function_Contracts.html#(form._((lib._racket/contract..rkt)._-~3e))" class="RktStxLink" pltdoc="x">-&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/guts..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">delay</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">nonnegative-number?</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">0.05</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">iterations</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="RktValLink" pltdoc="x">exact-nonnegative-integer?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">1</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">threads?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/guts..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">renderer</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">profile?</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym"><a href="../reference/Function_Contracts.html#(form._((lib._racket/contract..rkt)._-~3e))" class="RktStxLink" pltdoc="x">-&gt;</a></span><span class="RktPn"> .</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/guts..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#(def._((lib._profile/render-text..rkt)._render))" class="RktValLink" pltdoc="x">text:render</a></span></td></tr><tr><td><table cellspacing="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">periodic-renderer</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._list/c))" class="RktValLink" pltdoc="x">list/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym">nonnegative-number?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">profile?</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym"><a href="../reference/Function_Contracts.html#(form._((lib._racket/contract..rkt)._-~3e))" class="RktStxLink" pltdoc="x">-&gt;</a></span><span class="RktPn"> .</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/guts..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td>=</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVal">#f</span></td></tr></table></td></tr></table></div><div class="SIntrapara">Executes the given thunk while collecting profiling data, and render
this data when done.  Keyword arguments can customize the profiling:
</div><div class="SIntrapara"><ul><li><p>The profiler works by <span class="RktSym"><a href="#(def._((lib._profile/sampler..rkt)._create-sampler))" class="RktValLink" pltdoc="x">create-sampler</a></span> starting a
&ldquo;sampler&rdquo; thread whose job is to collect stack samples
periodically (using <span class="RktSym"><a href="../reference/contmarks.html#(def._((quote._~23~25kernel)._continuation-mark-set-~3econtext))" class="RktValLink" pltdoc="x">continuation-mark-set-&gt;context</a></span>).
<span class="RktVar">delay</span> determines the amount of time the sampler
<span class="RktSym"><a href="../reference/threads.html#(def._((quote._~23~25kernel)._sleep))" class="RktValLink" pltdoc="x">sleep</a></span>s for between samples.  Note that this is will be
close, but not identical to, the frequency in which data is actually
sampled.</p></li><li><p>When the profiled computation takes a short amount of time, the
collected data will not be accurate.  In this case, you can specify
an <span class="RktVar">iterations</span> argument to repeat the evaluation a number of
times which will improve the accuracy of the resulting report.</p></li><li><p>Normally, the sampler collects snapshots of the
<span class="RktSym"><a href="../reference/threads.html#(def._((quote._~23~25kernel)._current-thread))" class="RktValLink" pltdoc="x">current-thread</a></span>&rsquo;s stack.  If there is some computation that
happens on a different thread, that work will not be reflected in
the results: the only effect will be suspiciously small value for
the observed time, because the collected data is taking into account
the cpu time that the thread actually performed (it uses
<span class="RktSym"><a href="../reference/time.html#(def._((quote._~23~25kernel)._current-process-milliseconds))" class="RktValLink" pltdoc="x">current-process-milliseconds</a></span> with the running thread as an
argument).  Specifying a non-<span class="RktVal">#f</span> value for the
<span class="RktVar">threads?</span> argument will arrange for all threads that are
started during the evaluation to be tracked.  Note that this means
that the computation will actually run in a new sub-custodian, as
this is the only way to be able to track such threads.</p></li><li><p>Once the computation has finished, the sampler is stopped, and
the accumulated data is collected.  It is then analyzed by
<span class="RktSym"><a href="#(def._((lib._profile/analyzer..rkt)._analyze-samples))" class="RktValLink" pltdoc="x">analyze-samples</a></span>, and the analyzed profile data is fed into
a renderer.  Use an identity function (<span class="RktSym"><a href="../reference/values.html#(def._((quote._~23~25kernel)._values))" class="RktValLink" pltdoc="x">values</a></span>) to get the
analyzed result, and render it yourself, or use one of the existing
renderers (see <a href="#(part._renderers)" pltdoc="x">Profile Renderers</a>).</p></li><li><p>The <span class="RktVar">periodic-renderer</span> argument can be set to a list
holding a delay time and a renderer.  In this case, the given
renderer will be called periodically.  This is useful for cases
where you want a dynamically updated display of the results.  This
delay should be larger than the sampler delay.</p></li></ul></div></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._profile/main..rkt)._profile))"></a><a name="(form._((lib._profile/main..rkt)._profile))"></a><span title="Provided from: profile"><span class="RktSym"><a href="#(form._((lib._profile/main..rkt)._profile))" class="RktStxLink" pltdoc="x">profile</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktVar">keyword-arguments</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr></table></div><div class="SIntrapara">A macro version of <span class="RktSym"><a href="#(def._((lib._profile/main..rkt)._profile-thunk))" class="RktValLink" pltdoc="x">profile-thunk</a></span>.  The keyword arguments can
be specified in the same was as for a function call: they can appear
before and/or after the expression to be profiled.</div></p><h3>2<tt>&nbsp;</tt><a name="(part._sampler)"></a><a name="(mod-path._profile/sampler)"></a>Collecting Profile Information</h3><p><table cellspacing="0" class="defmodule"><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="RktStxLink" pltdoc="x">require</a></span><span class="stt"> </span><a href="#(mod-path._profile/sampler)" class="RktModLink" pltdoc="x"><span class="RktSym">profile/sampler</span></a><span class="RktPn">)</span></td></tr></table></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._profile/sampler..rkt)._create-sampler))"></a><a name="(def._((lib._profile/sampler..rkt)._create-sampler))"></a><span title="Provided from: profile/sampler"><span class="RktSym"><a href="#(def._((lib._profile/sampler..rkt)._create-sampler))" class="RktValLink" pltdoc="x">create-sampler</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">to-track</span><span class="hspace">&nbsp;</span><span class="RktVar">delay</span><span class="hspace">&nbsp;</span>[<span class="RktVar">super-cust</span>]<span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/symbols.html#(def._((quote._~23~25kernel)._symbol~3f))" class="RktValLink" pltdoc="x">symbol?</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/guts..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym"><a href="../reference/Function_Contracts.html#(form._((lib._racket/contract..rkt)._-~3e*))" class="RktStxLink" pltdoc="x">-&gt;*</a></span><span class="RktPn"> .</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/guts..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">to-track</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/threads.html#(def._((quote._~23~25kernel)._thread~3f))" class="RktValLink" pltdoc="x">thread?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/custodians.html#(def._((quote._~23~25kernel)._custodian~3f))" class="RktValLink" pltdoc="x">custodian?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._listof))" class="RktValLink" pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/threads.html#(def._((quote._~23~25kernel)._thread~3f))" class="RktValLink" pltdoc="x">thread?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/custodians.html#(def._((quote._~23~25kernel)._custodian~3f))" class="RktValLink" pltdoc="x">custodian?</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">delay</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">nonnegative-number?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">super-cust</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/custodians.html#(def._((quote._~23~25kernel)._custodian~3f))" class="RktValLink" pltdoc="x">custodian?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/custodians.html#(def._((quote._~23~25kernel)._current-custodian))" class="RktValLink" pltdoc="x">current-custodian</a></span><span class="RktPn">)</span></td></tr></table></div><div class="SIntrapara">Creates a sample collector thread, which tracks the given
<span class="RktVar">to-track</span> value every <span class="RktVar">delay</span> seconds.  The
<span class="RktVar">to-track</span> value can be either a thread (track just that
thread), a custodian (track all threads managed by the custodian), or
a list of threads and/or custodians.  If a custodian is given, it must
be subordinate to <span class="RktVar">super-cust</span>, which defaults to the current
custodian.</div></p><p><div class="SIntrapara">The resulting value is a controller function, which consumes a message
consisting of a symbol and an optional argument, and can affect the
sampler.  The following messages are currently supported:
</div><div class="SIntrapara"><ul><li><p><span class="RktVal">'</span><span class="RktVal">pause</span> and <span class="RktVal">'</span><span class="RktVal">resume</span> will stop or resume data
collection.  These messages can be nested.  Note that the thread will
continue running it will just stop collecting snapshots.</p></li><li><p><span class="RktVal">'</span><span class="RktVal">stop</span> kills the controlled thread.  It should be called
when no additional data should be collected.  (This is currently
irreversible: there is no message to start a new sampler thread.)</p></li><li><p><span class="RktVal">'</span><span class="RktVal">set-tracked!</span> with a value will change the tracked
objects (initially specified as the <span class="RktVar">to-track</span> argument) to
the given value.</p></li><li><p><span class="RktVal">'</span><span class="RktVal">set-tracked!</span> with a value will change the delay that
the sampler us taking between snapshots.  Note that although
changing this means that the snapshots are not uniformly
distributed, the results will still be sensible  &ndash;  this is because
the cpu time between samples is taken into account when the
resulting data is analyzed.</p></li><li><p>Finally, a <span class="RktVal">'</span><span class="RktVal">get-snapshots</span> message will make the
controller return the currently collected data.  Note that this can
be called multiple times, each call will return the data thatis
collected up to that point in time.  In addition, it can be (and
usually is) called after the sampler was stopped.</p><p>The value that is returned should be considered as an undocumented
internal detail of the profiler, to be sent to
<span class="RktSym"><a href="#(def._((lib._profile/analyzer..rkt)._analyze-samples))" class="RktValLink" pltdoc="x">analyze-samples</a></span> for analysis.  The reason this is not done
automatically, is that a future extension might allow you to combine
several sampler results, making it possible to combine a profile
analysis from several individual runs, possibly from different
machines.</p></li></ul></div></p><h3>3<tt>&nbsp;</tt><a name="(part._analyzer)"></a><a name="(mod-path._profile/analyzer)"></a>Analyzing Profile Data</h3><p><table cellspacing="0" class="defmodule"><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="RktStxLink" pltdoc="x">require</a></span><span class="stt"> </span><a href="#(mod-path._profile/analyzer)" class="RktModLink" pltdoc="x"><span class="RktSym">profile/analyzer</span></a><span class="RktPn">)</span></td></tr></table></p><p>Once a profile run is done, and the results are collected, the next
step is to analyze the data.  In this step the sample time are
computed and summed, a call-graph representing the observed function
calls is built, and per-node and per-edge information is created.
This is the job of the main function provided by
<span class="RktSym">profile/analyzer</span>.</p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._profile/analyzer..rkt)._analyze-samples))"></a><a name="(def._((lib._profile/analyzer..rkt)._analyze-samples))"></a><span title="Provided from: profile/analyzer"><span class="RktSym"><a href="#(def._((lib._profile/analyzer..rkt)._analyze-samples))" class="RktValLink" pltdoc="x">analyze-samples</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">raw-sample-data</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym">profile?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">raw-sample-data</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/guts..rkt)._any/c))" class="RktValLink" pltdoc="x">any/c</a></span></td></tr></table></div><div class="SIntrapara">This function consumes the raw result of the
<a href="#(part._sampler)" pltdoc="x">sampler</a> (which is given in an undocumented form),
analyzes it, and returns a <span class="RktSym">profile</span> value holding the analyzed
results.  Without this function, the results of the sampler are
meaningless.</div></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><table cellspacing="0"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define-struct.html#(form._((lib._racket/private/base..rkt)._struct))" class="RktStxLink" pltdoc="x">struct</a></span></td><td><span class="hspace">&nbsp;</span></td><td><a name="(dep._((lib._profile/analyzer..rkt)._profile-*-node))"></a><a name="(def._((lib._profile/analyzer..rkt)._profile-*-node))"></a><a name="(dep._((lib._profile/analyzer..rkt)._profile-nodes))"></a><a name="(def._((lib._profile/analyzer..rkt)._profile-nodes))"></a><a name="(dep._((lib._profile/analyzer..rkt)._profile-thread-times))"></a><a name="(def._((lib._profile/analyzer..rkt)._profile-thread-times))"></a><a name="(dep._((lib._profile/analyzer..rkt)._profile-sample-number))"></a><a name="(def._((lib._profile/analyzer..rkt)._profile-sample-number))"></a><a name="(dep._((lib._profile/analyzer..rkt)._profile-cpu-time))"></a><a name="(def._((lib._profile/analyzer..rkt)._profile-cpu-time))"></a><a name="(dep._((lib._profile/analyzer..rkt)._profile-total-time))"></a><a name="(def._((lib._profile/analyzer..rkt)._profile-total-time))"></a><a name="(dep._((lib._profile/analyzer..rkt)._make-profile))"></a><a name="(def._((lib._profile/analyzer..rkt)._make-profile))"></a><a name="(dep._((lib._profile/analyzer..rkt)._profile~3f))"></a><a name="(def._((lib._profile/analyzer..rkt)._profile~3f))"></a><a name="(dep._((lib._profile/analyzer..rkt)._struct~3aprofile))"></a><a name="(def._((lib._profile/analyzer..rkt)._struct~3aprofile))"></a><a name="(dep._((lib._profile/analyzer..rkt)._profile))"></a><a name="(def._((lib._profile/analyzer..rkt)._profile))"></a><span title="Provided from: profile/analyzer"><span class="RktSym">profile</span></span></td><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span></td><td><span class="RktSym">total-time</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym">cpu-time</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym">sample-number</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym">thread-times</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym">nodes</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym">*-node</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td colspan="3"><span class="RktPn">#:extra-constructor-name</span><span class="hspace">&nbsp;</span><span class="RktSym">make-profile</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">total-time</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="RktValLink" pltdoc="x">exact-nonnegative-integer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">cpu-time</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="RktValLink" pltdoc="x">exact-nonnegative-integer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">sample-number</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="RktValLink" pltdoc="x">exact-nonnegative-integer?</a></span></td></tr><tr><td><table cellspacing="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktSym">thread-times</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><table cellspacing="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._listof))" class="RktValLink" pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/pairs.html#(def._((quote._~23~25kernel)._cons))" class="RktValLink" pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="RktValLink" pltdoc="x">exact-nonnegative-integer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="RktValLink" pltdoc="x">exact-nonnegative-integer?</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">nodes</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._listof))" class="RktValLink" pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym">node?</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">*-node</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">node?</span></td></tr></table></div><div class="SIntrapara">Represents the analyzed profile result.</div></p><ul><li><p><span class="RktSym">total-time</span> is the total observed time (in milliseconds)
included in the profile.  This is different than the actual time the
profiling took, due to unaccounted-for time spent in untracked
threads.  (E.g., the sampler thread itself.)</p></li><li><p><span class="RktSym">cpu-time</span> is the actual cpu time consumed by the process
during the profiler&rsquo;s work.</p></li><li><p><span class="RktSym">sample-number</span> holds the number of samples taken during
the profile.  This can be used to compute the average time frame
each of the input samples represented.</p></li><li><p><span class="RktSym">thread-times</span> holds an association list mapping thread
identifiers to cpu time for the corresponding threads.  As samples
are collected, each thread that is observed is assigned a small
integer identifier.  These identifers are listed for each function
call, and the total time spent in each thread is in this field.</p></li><li><p><span class="RktSym">nodes</span> is a list of nodes representing all observed
functions.  These nodes are the components of the call-graph that
the analyzer assembles (see the <span class="RktSym">edge</span> field).  The nodes are
sorted by a topological top-to-bottom sort, and by decreasing total
amount of time (time spent either in the function or in its callees)
as a secondary key.</p></li><li><p><span class="RktSym">*-node</span> holds a &ldquo;special&rdquo; node value that is
constructed for every graph.  This node is used as the caller for
all top-level function nodes and as the callee for all leaf nodes.
It can therefore be used to start a scan of the call graph.  In
addition, the times associated with it&rsquo;s "callers and callees"
actually represent the time these functions spent being the root of
the computation or its leaf.  (This can be different from a node&rsquo;s
&ldquo;self&rdquo; time, since it is divided by the number of instances a
function had on the stack for every sample  &ndash;  so for recursive
functions this value is different from.)</p></li></ul><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><table cellspacing="0"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define-struct.html#(form._((lib._racket/private/base..rkt)._struct))" class="RktStxLink" pltdoc="x">struct</a></span></td><td><span class="hspace">&nbsp;</span></td><td><a name="(dep._((lib._profile/analyzer..rkt)._node-callees))"></a><a name="(def._((lib._profile/analyzer..rkt)._node-callees))"></a><a name="(dep._((lib._profile/analyzer..rkt)._node-callers))"></a><a name="(def._((lib._profile/analyzer..rkt)._node-callers))"></a><a name="(dep._((lib._profile/analyzer..rkt)._node-self))"></a><a name="(def._((lib._profile/analyzer..rkt)._node-self))"></a><a name="(dep._((lib._profile/analyzer..rkt)._node-total))"></a><a name="(def._((lib._profile/analyzer..rkt)._node-total))"></a><a name="(dep._((lib._profile/analyzer..rkt)._node-thread-ids))"></a><a name="(def._((lib._profile/analyzer..rkt)._node-thread-ids))"></a><a name="(dep._((lib._profile/analyzer..rkt)._node-src))"></a><a name="(def._((lib._profile/analyzer..rkt)._node-src))"></a><a name="(dep._((lib._profile/analyzer..rkt)._node-id))"></a><a name="(def._((lib._profile/analyzer..rkt)._node-id))"></a><a name="(dep._((lib._profile/analyzer..rkt)._make-node))"></a><a name="(def._((lib._profile/analyzer..rkt)._make-node))"></a><a name="(dep._((lib._profile/analyzer..rkt)._node~3f))"></a><a name="(def._((lib._profile/analyzer..rkt)._node~3f))"></a><a name="(dep._((lib._profile/analyzer..rkt)._struct~3anode))"></a><a name="(def._((lib._profile/analyzer..rkt)._struct~3anode))"></a><a name="(dep._((lib._profile/analyzer..rkt)._node))"></a><a name="(def._((lib._profile/analyzer..rkt)._node))"></a><span title="Provided from: profile/analyzer"><span class="RktSym">node</span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">id</span><span class="stt"> </span><span class="RktSym">src</span><span class="stt"> </span><span class="RktSym">thread-ids</span><span class="stt"> </span><span class="RktSym">total</span><span class="stt"> </span><span class="RktSym">self</span><span class="stt"> </span><span class="RktSym">callers</span><span class="stt"> </span><span class="RktSym">callees</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:extra-constructor-name</span><span class="hspace">&nbsp;</span><span class="RktSym">make-node</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">id</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/symbols.html#(def._((quote._~23~25kernel)._symbol~3f))" class="RktValLink" pltdoc="x">symbol?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">src</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._or/c))" class="RktValLink" pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/exns.html#(def._((quote._~23~25kernel)._srcloc~3f))" class="RktValLink" pltdoc="x">srcloc?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">thread-ids</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._listof))" class="RktValLink" pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="RktValLink" pltdoc="x">exact-nonnegative-integer?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">total</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="RktValLink" pltdoc="x">exact-nonnegative-integer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">self</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="RktValLink" pltdoc="x">exact-nonnegative-integer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">callers</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._listof))" class="RktValLink" pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym">edge?</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">callees</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._listof))" class="RktValLink" pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym">edge?</span><span class="RktPn">)</span></td></tr></table></div><div class="SIntrapara">Represents a function call node in the call graph of an analyzed
profile result.</div></p><ul><li><p>The <span class="RktSym">id</span> and <span class="RktSym">src</span> field hold a symbol naming the
function and/or its source location as a <span class="RktSym"><a href="../reference/exns.html#(def._((lib._racket/private/base..rkt)._srcloc))" class="RktValLink" pltdoc="x">srcloc</a></span> value.
This is the same as the results of
<span class="RktSym"><a href="../reference/contmarks.html#(def._((quote._~23~25kernel)._continuation-mark-set-~3econtext))" class="RktValLink" pltdoc="x">continuation-mark-set-&gt;context</a></span>, so at most of of these can
be <span class="RktVal">#f</span>, except for the special <span class="RktSym">*-node</span> (see the
<span class="RktSym">profile</span> struct) that can be identified by both of these
being <span class="RktVal">#f</span>.</p></li><li><p><span class="RktSym">thread-ids</span> holds a list of thread identifiers that were
observed executing this function.</p></li><li><p><span class="RktSym">total</span> holds the total time (in milliseconds) where this
function was anywhere on the stack.  It is common to see a few
toplevel functions that have close to a 100% total time, but
otherwise small <span class="RktSym">self</span> times  &ndash;  these functions are the ones
that derive the work that was done, but they don&rsquo;t do any hard work
directly.</p></li><li><p><span class="RktSym">self</span> holds the total time (in milliseconds) where this
function was observed as the leaf of the stack.  It represents the
actual work done by this function, rather than <span class="RktSym">total</span> that
represents the work done by both the function and its callees.</p></li><li><p><span class="RktSym">callers</span> and <span class="RktSym">callees</span> hold the list of caller
and callee nodes.  The nodes are not actually held in these lists,
instead, <span class="RktSym">edge</span> values are used  &ndash;  and provide information
specific to an edge in the call-graph.</p></li></ul><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><table cellspacing="0"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="../reference/define-struct.html#(form._((lib._racket/private/base..rkt)._struct))" class="RktStxLink" pltdoc="x">struct</a></span></td><td><span class="hspace">&nbsp;</span></td><td><a name="(dep._((lib._profile/analyzer..rkt)._edge-callee-time))"></a><a name="(def._((lib._profile/analyzer..rkt)._edge-callee-time))"></a><a name="(dep._((lib._profile/analyzer..rkt)._edge-callee))"></a><a name="(def._((lib._profile/analyzer..rkt)._edge-callee))"></a><a name="(dep._((lib._profile/analyzer..rkt)._edge-caller-time))"></a><a name="(def._((lib._profile/analyzer..rkt)._edge-caller-time))"></a><a name="(dep._((lib._profile/analyzer..rkt)._edge-caller))"></a><a name="(def._((lib._profile/analyzer..rkt)._edge-caller))"></a><a name="(dep._((lib._profile/analyzer..rkt)._edge-total))"></a><a name="(def._((lib._profile/analyzer..rkt)._edge-total))"></a><a name="(dep._((lib._profile/analyzer..rkt)._make-edge))"></a><a name="(def._((lib._profile/analyzer..rkt)._make-edge))"></a><a name="(dep._((lib._profile/analyzer..rkt)._edge~3f))"></a><a name="(def._((lib._profile/analyzer..rkt)._edge~3f))"></a><a name="(dep._((lib._profile/analyzer..rkt)._struct~3aedge))"></a><a name="(def._((lib._profile/analyzer..rkt)._struct~3aedge))"></a><a name="(dep._((lib._profile/analyzer..rkt)._edge))"></a><a name="(def._((lib._profile/analyzer..rkt)._edge))"></a><span title="Provided from: profile/analyzer"><span class="RktSym">edge</span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">total</span><span class="stt"> </span><span class="RktSym">caller</span><span class="stt"> </span><span class="RktSym">caller-time</span><span class="stt"> </span><span class="RktSym">callee</span><span class="stt"> </span><span class="RktSym">callee-time</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:extra-constructor-name</span><span class="hspace">&nbsp;</span><span class="RktSym">make-edge</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">total</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="RktValLink" pltdoc="x">exact-nonnegative-integer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">caller</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">node?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">caller-time</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="RktValLink" pltdoc="x">exact-nonnegative-integer?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">callee</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">node?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">callee-time</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="RktValLink" pltdoc="x">exact-nonnegative-integer?</a></span></td></tr></table></div><div class="SIntrapara">Represents an edge between two function call nodes in the call graph
of an analyzed profile result.</div></p><ul><li><p><span class="RktSym">total</span> is analogous to the <span class="RktSym">total</span> field of a
<span class="RktSym">node</span> value: the total time that this edge was anywhere on
the stack.</p></li><li><p><span class="RktSym">caller</span> and <span class="RktSym">callee</span> hold the two nodes that are
connected by this edge.</p></li><li><p><span class="RktSym">caller-time</span> and <span class="RktSym">callee-time</span> hold the time
spent on this edge from the caller&rsquo;s or the callee&rsquo;s perspective.
These times are different from each other (as well as from the total
time) because the sums that make them are each divided by the number
of times the caller or the callee was on the stack.</p><p>To understand this difference, consider a stack snapshot holding
<span class="stt">A </span><span class="stt">&rarr;</span><span class="stt"> B </span><span class="stt">&rarr;</span><span class="stt"> B </span><span class="stt">&rarr;</span><span class="stt"> B </span><span class="stt">&rarr;</span><span class="stt"> A</span>, and representing a
second of observed cpu time.  For this sample, the <span class="stt">A </span><span class="stt">&rarr;</span><span class="stt"> B</span>
edge is charged by a whole second for its total time (the same goes
for the <span class="stt">A </span><span class="stt">&rarr;</span><span class="stt"> A</span> edge, for example).  Its caller time is
charged 1/2 second because <span class="stt">A</span> appears twice in this stack
snapshot (in the other half, <span class="stt">A</span> is chared for being a leaf  &ndash; 
the caller of the special <span class="RktSym">*-node</span>), and its callee time is
charged 1/3 respectively.</p></li></ul><h3>4<tt>&nbsp;</tt><a name="(part._renderers)"></a>Profile Renderers</h3><p>After collecting the profile samples and analyzing the data, the last
aspect of profiling is to render the results.  The profile collection
provides several renderers, each providing a rendering function that
consumes a <span class="RktSym">profile</span> instance.  See the
<a href="#(part._analyzer)" pltdoc="x">analyzer</a> section for a description of the
<span class="RktSym">profile</span> struct if you want to implement your own renderer.</p><h4>4.1<tt>&nbsp;</tt><a name="(part._.Textual_.Rendering)"></a><a name="(mod-path._profile/render-text)"></a>Textual Rendering</h4><p><table cellspacing="0" class="defmodule"><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="RktStxLink" pltdoc="x">require</a></span><span class="stt"> </span><a href="#(mod-path._profile/render-text)" class="RktModLink" pltdoc="x"><span class="RktSym">profile/render-text</span></a><span class="RktPn">)</span></td></tr></table></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><table cellspacing="0" class="prototype"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._profile/render-text..rkt)._render))"></a><a name="(def._((lib._profile/render-text..rkt)._render))"></a><span title="Provided from: profile/render-text"><span class="RktSym">render</span></span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">profile-data</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span>[</td><td><span class="RktPn">#:truncate-source</span><span class="hspace">&nbsp;</span><span class="RktVar">truncate-source</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:hide-self</span><span class="hspace">&nbsp;</span><span class="RktVar">hide-self%</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:hide-subs</span><span class="hspace">&nbsp;</span><span class="RktVar">hide-subs%</span>]<span class="RktPn">)</span></td><td><span class="hspace">&nbsp;</span></td><td>&rarr;</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="../reference/void.html#(def._((quote._~23~25kernel)._void~3f))" class="RktValLink" pltdoc="x">void?</a></span></td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">profile-data</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">profile?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">truncate-source</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="../reference/number-types.html#(def._((quote._~23~25kernel)._exact-nonnegative-integer~3f))" class="RktValLink" pltdoc="x">exact-nonnegative-integer?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">50</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">hide-self%</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._between/c))" class="RktValLink" pltdoc="x">between/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">1/100</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">hide-subs%</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._between/c))" class="RktValLink" pltdoc="x">between/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">1/50</span></td></tr></table></div><div class="SIntrapara">Prints the given <span class="RktSym">profile</span> results as a textual table.</div></p><p>The printout begins with some general facts about the profile, and
then a table that represents the call-graph is printed.  Each row in
this table looks like:</p><p><table cellspacing="0"><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">B [M1] M2%</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span>[N1] N2(N3%) N4(N5%)<span class="hspace">&nbsp;&nbsp;</span><span class="stt">A ...path/to/source.ss:12:34</span></span></p></td></tr><tr><td><p><span class="stt"><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">C [M3] M4%</span></span></p></td></tr></table></p><p><div class="SIntrapara">Where actual numbers appear in the printout.  The meaning of the
numbers and labels is as follows:
</div><div class="SIntrapara"><ul><li><p><span class="stt">A</span>  &ndash;  the name of the function that this node represents,
followed by the source location for the function if it is known.
The name can be &ldquo;???&rdquo; for functions with no identifier, but in
this case the source location will identify them.</p></li><li><p><span class="stt">N1</span>  &ndash;  an index number associated with this node.  This is
important in references to this function, since the symbolic names
are not unique (and some can be missing).  The number itself has no
significance, it simply goes from 1 up.</p></li><li><p><span class="stt">N2</span>  &ndash;  the time (in milliseconds) that this function has
been anywhere in a stack snapshot.  This is the total time that the
execution was somewhere in this function or in its callees.
(Corresponds to the <span class="RktSym">node-total</span> field.)</p></li><li><p><span class="stt">N3</span>  &ndash;  this is the percentage of the node&rsquo;s total time
(<span class="stt">N2</span>) from the total observed time of the profile.  An entry
with a 100% refers to a function that was active throughout the
whole execution.</p></li><li><p><span class="stt">N4</span>  &ndash;  the time (in milliseconds) that this function has
been at the top of the stack snapshot.  This is the time that this
function consumed doing work itself rather than calling other
functions.  (Corresponds to the <span class="RktSym">node-self</span> field.)</p></li><li><p><span class="stt">N5</span>  &ndash;  this is the percentage of <span class="stt">N4</span> out of the total
observed time of the profile.  Functions with high values here can
be good candidates for optimization, But, of course, they can
represent doing real work due to one of its callers that need to be
optimized.</p></li><li><p><span class="stt">B</span> and <span class="stt">C</span>  &ndash;  these are labels for the callers and
callees of the function.  Any number of callers and callees can
appear here (including 0).  The function itself can also appear in
both places if it is (non-tail) recursive.</p></li><li><p><span class="stt">M1</span> and <span class="stt">M3</span>  &ndash;  the index numbers for <span class="stt">B</span> and
<span class="stt">C</span>.  They can be used to disambiguate functions with the same
name, as well as a quick way to find the corresponding entry in the
table.</p></li><li><p><span class="stt">M2</span> and <span class="stt">M4</span>  &ndash;  the percentages of the time <span class="stt">A</span> spent
being called by <span class="stt">B</span> and calling <span class="stt">C</span>.  These percentages
represent the time that this edge was found on a stack snapshot,
divided by the number of occurrences of <span class="stt">A</span> on the same snapshot.
The number is the percentage of these times out of <span class="stt">N2</span>, the
total time <span class="stt">A</span> has been active.</p><p>The total percentages for the all caller and for all callees should
be close to 100% minus the time <span class="stt">A</span> was the leaf or the root.</p><p>These values correspond to the <span class="RktSym">edge-caller-time</span> and
<span class="RktSym">edge-callee-time</span> fields; see the documentation for further
details.</p></li></ul></div></p><p><div class="SIntrapara">The function has a few keyword arguments to customize its output:
</div><div class="SIntrapara"><ul><li><p>The <span class="RktVar">truncate-source</span> argument determines the length that
the source string should take (together with its label).</p></li><li><p><span class="RktVar">hide-self%</span> and <span class="RktVar">hide-subs%</span> control hiding some
of the nodes.  A node is hidden if its self time (<span class="stt">N3</span> in the
above example) is smaller than <span class="RktVar">hide-self%</span> <span style="font-style: italic">and</span> if all
places where it occurs as a caller or a callee have percentages that
are smaller than <span class="RktVar">hide-subs%</span>.  The reason for requiring both
conditions is to avoid having &ldquo;dangling references&rdquo; to hidden
nodes.</p></li></ul></div></p><h4>4.2<tt>&nbsp;</tt><a name="(part._.Graph_.Rendering)"></a><a name="(mod-path._profile/render-graphviz)"></a>Graph Rendering</h4><p><table cellspacing="0" class="defmodule"><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/require.html#(form._((lib._racket/private/base..rkt)._require))" class="RktStxLink" pltdoc="x">require</a></span><span class="stt"> </span><a href="#(mod-path._profile/render-graphviz)" class="RktModLink" pltdoc="x"><span class="RktSym">profile/render-graphviz</span></a><span class="RktPn">)</span></td></tr></table></p><p><div class="SIntrapara"><table cellspacing="0" class="boxed"><tr><td><table cellspacing="0" class="prototype"><tr><td><span class="RktPn">(</span><a name="(dep._((lib._profile/render-graphviz..rkt)._render))"></a><a name="(def._((lib._profile/render-graphviz..rkt)._render))"></a><span title="Provided from: profile/render-graphviz"><span class="RktSym">render</span></span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktVar">profile-data</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span>[</td><td><span class="RktPn">#:hide-self</span><span class="hspace">&nbsp;</span><span class="RktVar">hide-self%</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktPn">#:hide-subs</span><span class="hspace">&nbsp;</span><span class="RktVar">hide-subs%</span>]<span class="RktPn">)</span></td><td><span class="hspace">&nbsp;</span></td><td>&rarr;</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="../reference/void.html#(def._((quote._~23~25kernel)._void~3f))" class="RktValLink" pltdoc="x">void?</a></span></td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">profile-data</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">profile?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">hide-self%</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._between/c))" class="RktValLink" pltdoc="x">between/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">1/100</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">hide-subs%</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../reference/Data-structure_Contracts.html#(def._((lib._racket/contract/private/misc..rkt)._between/c))" class="RktValLink" pltdoc="x">between/c</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">1/50</span></td></tr></table></div><div class="SIntrapara">Prints the given <span class="RktSym">profile</span> results as a Graphviz directed
graph.</div></p><p>This is an experimental module, provided mostly as a proof-of-concept.
It renders the profile&rsquo;s call-graph as a graph representation for one
of the Graphviz tools to render.  Nodes are colored according to their
`self&rsquo; percentages, and edges.</p><p>The keyword arguments control hiding nodes in the same way as with the
textual renderer.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.0.2&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.0.2&quot;);">top</a></span><span class="navright"><span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.0.2&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>